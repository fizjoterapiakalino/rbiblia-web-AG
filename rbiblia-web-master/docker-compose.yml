# rBiblia Web - Docker Compose Configuration
services:
    web:
        build:
            context: .
            target: development
        container_name: rbiblia-web
        volumes:
            - .:/var/www/html
            - /var/www/html/node_modules
            - /var/www/html/src/vendor
        ports:
            - "8080:80"
        environment:
            - APP_ENV=development
            - PHP_DISPLAY_ERRORS=1
        depends_on:
            - db
        restart: unless-stopped

    db:
        image: mariadb:10.6
        container_name: rbiblia-db
        command: --default-authentication-plugin=mysql_native_password
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: rbiblia
            MYSQL_USER: user
            MYSQL_PASSWORD: password
        volumes:
            - rbiblia_db_data:/var/lib/mysql
            # Automatyczny import struktury przy pierwszym starcie
            - ./docs/db_structure.sql:/docker-entrypoint-initdb.d/db_structure.sql
        ports:
            - "3306:3306"

    # Opcjonalnie: Adminer do podglÄ…du bazy
    adminer:
        image: adminer
        container_name: rbiblia-adminer
        ports:
            - "8081:8080"
        restart: unless-stopped

volumes:
    rbiblia_db_data:
